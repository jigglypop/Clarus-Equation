# 7.2 SFE와 양자 오류 정정(QEC)의 결합 아키텍처

## 1. 개요: 하이브리드 보호 전략

양자 컴퓨터의 실용화를 가로막는 가장 큰 장벽은 양자 상태의 결맞음(Decoherence)과 노이즈이다. 이를 해결하기 위해 두 가지 주요 접근 방식이 존재한다.

1.  **동적 디커플링(Dynamical Decoupling, DD)**: 펄스 제어를 통해 환경 노이즈의 영향을 억제하는 "개방 루프" 제어 기술. (SFE의 주력 분야)
2.  **양자 오류 정정(Quantum Error Correction, QEC)**: 여러 물리적 큐비트를 얽어 논리적 큐비트를 구성하고, 신드롬 측정을 통해 오류를 능동적으로 수정하는 "폐쇄 루프" 피드백 기술.

SFE 이론은 이 두 가지를 상호 보완적으로 결합하는 **SFE-QEC 하이브리드 아키텍처**를 제안한다. SFE 엔진은 물리적 큐비트 레벨에서 1/f 노이즈(핑크 노이즈)를 강력하게 억제하여 "유효 오류율(Effective Error Rate)"을 낮추고, QEC는 남은 희박한 오류를 논리적 수준에서 정정한다.

## 2. SFE의 역할: 노이즈 백색화 및 임계값 돌파

QEC 코드(예: 표면 코드, Surface Code)가 작동하기 위해서는 물리적 큐비트의 오류율($p_{phy}$)이 특정 임계값($p_{th}$, 약 1% 미만)보다 낮아야 한다. 또한, 대부분의 QEC 이론은 노이즈가 시간적으로 상관관계가 없는 "백색 노이즈(White Noise)"라고 가정한다.

그러나 실제 양자 하드웨어(초전도 큐비트 등)는 저주파 대역이 강한 **1/f 노이즈**가 지배적이며, 이는 긴 시간 상관관계를 가져 QEC의 성능을 급격히 저하시킨다.

**SFE 엔진의 핵심 역할**은 다음과 같다.
1.  **노이즈 스펙트럼 성형(Shaping)**: 최적화된 펄스 시퀀스를 통해 저주파 1/f 노이즈를 필터링한다. 이는 유효 노이즈 스펙트럼을 고주파 대역으로 밀어내어, 실질적으로 노이즈를 "백색화(Whitening)"하는 효과를 낸다.
2.  **오류율 감소**: $p_{phy}$를 QEC 임계값($p_{th}$) 아래로 낮춘다.

## 3. 수학적 모델링

### 3.1 물리적 오류율과 SFE

SFE 이론의 필터 함수 관점에서, $T$ 시간 동안의 결맞음 함수는 다음과 같다.

$$
S(T) = \exp\left(-\int_0^\infty \frac{d\omega}{2\pi} S_\Phi(\omega) |Y(\omega; T)|^2\right)
$$

QEC가 주기 $\tau_{QEC}$마다 수행된다면, 한 주기 동안 발생할 물리적 위상 오류 확률 $p_{phy}$는 다음과 같이 근사할 수 있다.

$$
p_{phy}(\tau_{QEC}) \approx \frac{1 - S(\tau_{QEC})}{2} \approx \frac{\chi(\tau_{QEC})}{2}
$$

여기서 $\chi(\tau_{QEC})$는 SFE 제어 하에서의 잔여 위상 분산이다.

### 3.2 논리적 오류율 예측

거리 $d$의 QEC 코드를 적용할 때, 논리적 오류율 $P_L$은 다음과 같이 스케일링된다.

$$
P_L \propto A \left( \frac{p_{phy}}{p_{th}} \right)^{\frac{d+1}{2}}
$$

SFE 엔진이 최적화된 제어 $y(t)$를 통해 $p_{phy}$를 기존 값의 1/10로 줄인다면, 논리적 오류율은 $(1/10)^{(d+1)/2}$만큼, 즉 지수적으로 개선된다.

## 4. 러스트(Rust) 엔진 구현 및 시뮬레이션

SFE 상용 엔진(`sfe_core`)에는 `qec` 모듈이 탑재되어 이러한 하이브리드 효과를 검증한다.

### 4.1 시뮬레이션 알고리즘
1.  **노이즈 생성**: SFE 이론에 기반한 핑크 노이즈($1/f^\alpha$)를 생성한다.
2.  **SFE 제어**: 유전 알고리즘으로 찾은 최적 펄스 시퀀스를 인가하여 노이즈의 영향을 상쇄한다.
3.  **QEC 루프**: 주기적으로 큐비트 상태를 측정하고, 단순화된 반복 코드(Repetition Code) 로직을 적용하여 다수결 원칙으로 오류를 정정한다.

### 4.2 벤치마크 결과 (예시)
`sfe_core` 시뮬레이션 결과, 강한 노이즈 환경(진폭 0.25)에서도 SFE 제어를 적용하면 QEC 주기를 50 step으로 설정했을 때 **논리적 오류가 0건으로 완벽하게 방어**됨을 확인하였다. 이는 SFE가 위상 누적을 $\pi/2$ 임계값 이내로 억제하는 데 성공했기 때문이다.

### 4.3 장기 가중 목적함수: QEC 관점에서 본 SFE 최적화

위 4.2절까지의 구현은 한 번의 디커플링 구간이 끝났을 때의 단일 결맞음 값 $S(T) = \cos\phi(T)$만을 기준으로 펄스 시퀀스를 평가하였다. 그러나 QEC 관점에서 보면 중요한 것은 단일 시점 $T$가 아니라, **여러 QEC 주기 동안 장시간에 걸쳐 결맞음이 얼마나 안정적으로 유지되는가**이다.

이를 반영하기 위해 `optimizer.rs`에서 사용되는 핵심 목적함수 `evaluate_sequence_with_pool`는 다음과 같은 **다중 체크포인트 가중 평균 구조**로 재정의된다.

1.  시간 축을 $N$ 스텝으로 이산화했다고 하자. 각 노이즈 궤적에 대해, 펄스 시퀀스 $\{t_j\}$가 주어졌을 때 위상은
    $$
    \phi(t) = \int_0^t dt'\, y(t')\,\delta\Phi(t')
    $$
    로 누적되며, 여기서 $y(t')$는 토글 함수($\pm 1$)이다.

2.  과거 버전에서는 최종 시점 $T$에서의 $S(T)=\cos\phi(T)$만을 사용했다. 이제는 전체 시간 구간 $[0,T]$를 네 개의 비율
    $$
    r_0 = 0.4,\quad r_1 = 0.6,\quad r_2 = 0.8,\quad r_3 = 1.0
    $$
    에 해당하는 체크포인트
    $$
    t_k = r_k T
    $$
    에서 각각의 결맞음
    $$
    S_k \equiv \cos\phi(t_k)
    $$
    를 계산한다.

3.  QEC 입장에서 가장 중요한 것은 후반부(여러 번의 신드롬 측정 이후)까지 결맞음이 유지되는지 여부이므로, 네 체크포인트에 서로 다른 가중치를 부여한다.
    $$
    w_0 = 1,\quad w_1 = 2,\quad w_2 = 3,\quad w_3 = 4
    $$
    이때 한 궤적에 대한 **장기 가중 결맞음 점수**는
    $$
    S_{\text{eff}} = \frac{\sum_{k=0}^3 w_k S_k}{\sum_{k=0}^3 w_k}
    $$
    로 정의한다. 즉, 동일한 펄스 시퀀스라도 초기 구간보다는 $0.8T,\,T$ 근처에서의 성능이 더 크게 반영되도록 설계되어 있다.

4.  마지막으로, 노이즈 풀(noise pool)에 포함된 여러 독립 궤적에 대해 $S_{\text{eff}}$를 평균내어, 해당 펄스 시퀀스의 최종 점수를 얻는다.
    $$
    \bar{S}_{\text{eff}} = \frac{1}{M} \sum_{i=1}^M S_{\text{eff}}^{(i)}
    $$
    여기서 $M$은 사용한 노이즈 궤적의 개수이다.

이와 같이 목적함수를 재정의하면, 유전 알고리즘은 자연스럽게

-   **초기 짧은 시간 구간에서만 좋은 시퀀스**보다는,
-   **여러 QEC 주기를 거친 뒤에도 결맞음이 유지되는 시퀀스**

을 선호하게 된다. 이는 실제 QEC 엔진과의 결합을 염두에 둔, 보다 물리적으로 정당화된 최적화 방식이다.

### 4.4 하드웨어 매칭 노이즈 모델: $1/f^\alpha$와 T1 피드백

`noise.rs`에서 정의된 `PinkNoiseGenerator`는 기본적으로 $S_\Phi(\omega)\propto 1/\omega$ 형태의 핑크 노이즈를 생성한다. 그러나 실제 하드웨어(예: IBM Fez)에서 측정한 T1, T2 값은 단순한 $1/f$ 법칙에서 조금 벗어날 수 있으며, 전체 스케일도 장치별로 달라진다.

이를 반영하기 위해, 최신 버전의 엔진에서는 다음과 같이 **다중 파라미터 노이즈 생성기**를 사용한다.

1.  스펙트럼 밀도
    $$
    S_\Phi(\omega) = \frac{A}{\omega^\alpha}
    $$
    로 두고, 여기서 $\alpha$는 스펙트럼 기울기, $A$는 전체 세기를 나타낸다.

2.  푸리에 공간에서의 진폭은 전력 스펙트럼과의 관계에 따라
    $$
    |\tilde{\Phi}(\omega)| \propto \frac{1}{\omega^{\alpha/2}}
    $$
    로 스케일링되며, 실제 구현에서는
    $$
    \tilde{\Phi}_k = \text{Normal}(0,1)\times \frac{\text{scale}}{f_k^{\alpha/2}}
    $$
    꼴로 주파수 모드별 난수를 생성한 뒤, 역 푸리에 변환을 취해 시간 영역 노이즈를 얻는다.

3.  하드웨어에서 얻은 T1 데이터(예: 시간 지연에 따른 $P_1(t)$ 감쇠 곡선)는 위 스펙트럼 파라미터 $(\alpha, A)$를 추정하는 데 사용될 수 있다. 이 과정은 SFE 이론의 근본 상수(억압 계수 $\epsilon$ 등)를 **튜닝하는 것이 아니라**, 주어진 장치의 고유한 환경 노이즈를 계측하여 **효과적인 노이즈 모델을 구성**하는 공학적 절차에 해당한다.

정리하면, `PinkNoiseGenerator::new_with_params(steps, \alpha, \text{scale})` 형태의 생성기를 사용함으로써, SFE 엔진은

-   순수 이론적 $1/f$ 노이즈,
-   특정 장치에서 관측된 T1, T2를 반영한 **하드웨어 매칭 노이즈**,

두 가지를 모두 다룰 수 있게 된다. 전자는 이론적 탐구와 범용성을, 후자는 실제 양자 하드웨어에 대한 정밀 적용을 담당한다.

## 5. 결론

SFE와 QEC의 결합은 선택이 아닌 필수이다. SFE는 하드웨어의 "물리적 체질"을 개선하여 QEC가 작동할 수 있는 환경을 조성하며, QEC는 SFE가 걸러내지 못한 미세한 잔여 오류를 제거하여 완벽한 논리적 큐비트를 완성한다. 이 하이브리드 엔진은 양자 컴퓨터 상용화의 핵심 소프트웨어 스택이 될 것이다.

